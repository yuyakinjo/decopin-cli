# 要件定義書

## 概要

この機能は、現在の `src/` ディレクトリ構造をハンドラーの責務ごとに整理し、関心の分離を明確にして保守性を向上させるリファクタリングです。現在の混在した構造から、各ハンドラータイプが専用のスペースを持つハンドラー中心の組織化に移行し、共有ユーティリティを適切に集約することが目標です。

## 要件

### 要件 1

**ユーザーストーリー:** decopin-cliのコードベースで作業する開発者として、ソースコードがハンドラータイプごとに整理されていることで、ハンドラー固有のロジックを簡単に見つけて保守できるようにしたい。

#### 受け入れ基準

1. srcディレクトリに移動したとき、8つのコアハンドラーそれぞれに対応するハンドラー固有のサブディレクトリが表示される
2. コマンドハンドラーのロジックを探すとき、専用のコマンドハンドラーディレクトリで見つけることができる
3. パラメータ検証ロジックを探すとき、専用のparamsハンドラーディレクトリで見つけることができる
4. ヘルプシステムのロジックを探すとき、専用のhelpハンドラーディレクトリで見つけることができる
5. エラーハンドリングのロジックを探すとき、専用のerrorハンドラーディレクトリで見つけることができる
6. ミドルウェアのロジックを探すとき、専用のmiddlewareハンドラーディレクトリで見つけることができる
7. 環境処理のロジックを探すとき、専用のenvハンドラーディレクトリで見つけることができる
8. バージョン処理のロジックを探すとき、専用のversionハンドラーディレクトリで見つけることができる
9. グローバルエラーハンドリングのロジックを探すとき、専用のglobal-errorハンドラーディレクトリで見つけることができる

### 要件 2

**ユーザーストーリー:** 共有機能で作業する開発者として、共通ユーティリティがutilsディレクトリに集約されていることで、コードの重複を避け、ハンドラー間で一貫性を保てるようにしたい。

#### 受け入れ基準

1. 共有検証ロジックが必要なとき、utilsディレクトリで見つけることができる
2. 共有タイプガードが必要なとき、utilsディレクトリで見つけることができる
3. 共有ヘルパー関数が必要なとき、utilsディレクトリで見つけることができる
4. 複数のハンドラーが同じ機能を必要とするとき、utilsで一度実装してインポートする
5. 新しい共有機能を追加するとき、適切なutilsサブディレクトリに配置する

### 要件 3

**ユーザーストーリー:** コードベースを保守する開発者として、各ハンドラーディレクトリ内のファイル構成が明確であることで、構造を素早く理解し、特定の機能を見つけられるようにしたい。

#### 受け入れ基準

1. ハンドラーディレクトリに入ったとき、すべてのハンドラーで一貫したファイル構造が表示される
2. ハンドラーの実装を探すとき、ハンドラーディレクトリ内のindex.tsファイルで見つけることができる
3. ハンドラー固有の型を探すとき、ハンドラーディレクトリ内のtypes.tsファイルで見つけることができる
4. ハンドラー固有のユーティリティを探すとき、ハンドラーディレクトリ内のハンドラー固有ファイルで見つけることができる
5. ハンドラーが複雑なロジックを持つとき、ハンドラーディレクトリ内で論理的なサブファイルに分割されている

### 要件 4

**ユーザーストーリー:** コアシステムで作業する開発者として、コア機能（スキャナー、エグゼキューター、パフォーマンス）がハンドラーから分離されていることで、システムアーキテクチャが明確に保たれるようにしたい。

#### 受け入れ基準

1. コアシステムロジックを探すとき、専用のcoreディレクトリで見つけることができる
2. スキャナー機能を探すとき、coreディレクトリで見つけることができる
3. エグゼキューター機能を探すとき、coreディレクトリで見つけることができる
4. パフォーマンス監視を探すとき、coreディレクトリで見つけることができる
5. コア機能がハンドラーと相互作用する必要があるとき、明確なインターフェースと抽象化が表示される

### 要件 5

**ユーザーストーリー:** コード生成で作業する開発者として、ジェネレーター機能が分離され整理されていることで、ビルド時とランタイムの関心事が明確に分離されるようにしたい。

#### 受け入れ基準

1. コード生成ロジックを探すとき、専用のgeneratorディレクトリで見つけることができる
2. テンプレート生成を探すとき、generatorディレクトリで見つけることができる
3. 環境型生成を探すとき、generatorディレクトリで見つけることができる
4. ジェネレーターが共有ユーティリティを必要とするとき、utilsディレクトリから適切にインポートされている

### 要件 6

**ユーザーストーリー:** プロジェクトで作業する開発者として、リファクタリング後もすべてのインポートとエクスポートが継続して動作することで、パブリックAPIと内部機能が損なわれないようにしたい。

#### 受け入れ基準

1. 外部コードがライブラリからインポートするとき、パブリックAPIに破壊的変更がない
2. 内部モジュールが相互にインポートするとき、すべてのインポートが新しい構造を反映して更新されている
3. ビルドプロセスが実行されるとき、不足したインポートによるコンパイルエラーがない
4. テストが実行されるとき、すべてのテストインポートが更新され、パスしている
5. CLIが実行されるとき、リファクタリング前と同様にすべての機能が動作している
