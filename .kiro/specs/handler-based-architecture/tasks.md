# 実装計画

- [x] 1. ユーティリティディレクトリの再編成
  - 共通ユーティリティを新しい構造に移動し、インポートパスを更新する
  - バリデーション、タイプガード、エラー処理を適切なサブディレクトリに配置する
  - _要件: 2.1, 2.2, 2.3, 2.4, 2.5_

- [x] 1.1 バリデーションユーティリティの再編成
  - `src/utils/validation/`ディレクトリを作成
  - 既存の`src/utils/validation.ts`を`src/utils/validation/index.ts`に移動
  - valibotとマニュアルバリデーションを分離したファイル構造を作成
  - _要件: 2.1, 2.4_

- [x] 1.2 タイプガードの移動と再編成
  - `src/utils/guards/`ディレクトリを作成
  - `src/internal/guards/`の全ファイルを`src/utils/guards/`に移動
  - インポートパスを更新してinternalディレクトリを削除
  - _要件: 2.2, 2.4_

- [x] 1.3 エラー処理ユーティリティの集約
  - `src/utils/errors/`ディレクトリを作成
  - 分散しているエラー処理ロジックを集約
  - エラーフォーマット機能を統合
  - _要件: 2.3, 2.4_

- [ ] 2. コマンドハンドラーの実装
  - 既存のcommandディレクトリの内容をhandlers/commandに移動し、統一されたハンドラー構造を作成する
  - _要件: 1.2, 3.1, 3.2, 3.3, 3.4_

- [ ] 2.1 コマンドハンドラーディレクトリの作成
  - `src/handlers/command/index.ts`を作成してメインハンドラーロジックを実装
  - 既存の`src/command/index.ts`の内容を移動
  - _要件: 1.2, 3.1, 3.2_

- [ ] 2.2 コマンドパーサーとジェネレーターの移動
  - `src/command/parser.ts`を`src/handlers/command/parser.ts`に移動
  - `src/command/generator.ts`を`src/handlers/command/generator.ts`に移動
  - インポートパスを更新
  - _要件: 1.2, 3.4_

- [ ] 2.3 コマンド固有型定義の分離
  - `src/command/types.ts`を`src/handlers/command/types.ts`に移動
  - コマンド関連の型を`src/types/`から分離
  - _要件: 1.2, 3.3_

- [ ] 3. パラメータハンドラーの実装
  - パラメータ処理ロジックを専用ハンドラーディレクトリに実装する
  - _要件: 1.3, 3.1, 3.2, 3.3_

- [ ] 3.1 パラメータハンドラーの基本構造作成
  - `src/handlers/params/index.ts`を作成
  - パラメータ処理の統合ロジックを実装
  - _要件: 1.3, 3.1, 3.2_

- [ ] 3.2 パラメータバリデーションの分離
  - `src/handlers/params/validation.ts`を作成
  - バリデーション固有のロジックを分離
  - _要件: 1.3, 3.4_

- [ ] 3.3 パラメータ固有型定義の作成
  - `src/handlers/params/types.ts`を作成
  - パラメータ関連の型定義を集約
  - _要件: 1.3, 3.3_

- [ ] 4. その他のハンドラーの実装
  - help、error、middleware、env、version、global-errorハンドラーを実装する
  - _要件: 1.4, 1.5, 1.6, 1.7, 1.8, 1.9, 3.1, 3.2, 3.3_

- [ ] 4.1 ヘルプハンドラーの実装
  - `src/handlers/help/index.ts`と`src/handlers/help/types.ts`を作成
  - ヘルプ生成ロジックを実装
  - _要件: 1.4, 3.1, 3.2, 3.3_

- [ ] 4.2 エラーハンドラーの実装
  - `src/handlers/error/index.ts`と`src/handlers/error/types.ts`を作成
  - エラー処理ロジックを実装
  - _要件: 1.5, 3.1, 3.2, 3.3_

- [ ] 4.3 ミドルウェアハンドラーの実装
  - `src/handlers/middleware/index.ts`と`src/handlers/middleware/types.ts`を作成
  - ミドルウェア処理ロジックを実装
  - _要件: 1.6, 3.1, 3.2, 3.3_

- [ ] 4.4 環境変数ハンドラーの実装
  - `src/handlers/env/index.ts`と`src/handlers/env/types.ts`を作成
  - 環境変数処理ロジックを実装
  - _要件: 1.7, 3.1, 3.2, 3.3_

- [ ] 4.5 バージョンハンドラーの実装
  - `src/handlers/version/index.ts`と`src/handlers/version/types.ts`を作成
  - バージョン処理ロジックを実装
  - _要件: 1.8, 3.1, 3.2, 3.3_

- [ ] 4.6 グローバルエラーハンドラーの実装
  - `src/handlers/global-error/index.ts`と`src/handlers/global-error/types.ts`を作成
  - グローバルエラー処理ロジックを実装
  - _要件: 1.9, 3.1, 3.2, 3.3_

- [ ] 5. 型定義の再編成
  - 共通型定義を整理し、ハンドラー固有の型を分離する
  - _要件: 3.3, 6.1, 6.2_

- [ ] 5.1 共通型定義の整理
  - `src/types/index.ts`からハンドラー固有の型を削除
  - 共通型のみを残して統合エクスポートを更新
  - _要件: 3.3, 6.1_

- [ ] 5.2 ハンドラーレジストリの更新
  - `src/types/handler-registry.ts`を新しいハンドラー構造に対応
  - 必要に応じてレジストリ定義を更新
  - _要件: 4.5, 6.1_

- [ ] 6. インポートパスの全面更新
  - すべてのファイルのインポート文を新しい構造に合わせて更新する
  - _要件: 6.1, 6.2, 6.3_

- [ ] 6.1 コアシステムのインポート更新
  - `src/core/`配下のファイルのインポートパスを更新
  - ハンドラーエグゼキューターのインポートを新しい構造に対応
  - _要件: 4.5, 6.1, 6.2_

- [ ] 6.2 ジェネレーターのインポート更新
  - `src/generator/`配下のファイルのインポートパスを更新
  - 新しいユーティリティ構造に対応
  - _要件: 5.4, 6.1, 6.2_

- [ ] 6.3 エントリーポイントの更新
  - `src/index.ts`と`src/cli.ts`のインポートパスを更新
  - パブリックAPIの互換性を維持
  - _要件: 6.1, 6.2_

- [ ] 7. テストファイルの更新
  - テスト構造を新しいハンドラー構造に合わせて更新する
  - _要件: 6.4, 6.5_

- [ ] 7.1 ユーティリティテストの移動
  - `test/utils/validation.test.ts`を`test/utils/validation/`に移動
  - `test/internal/guards/`を`test/utils/guards/`に移動
  - テストのインポートパスを更新
  - _要件: 6.4_

- [ ] 7.2 ハンドラーテストの作成
  - 各ハンドラーに対応するテストディレクトリを作成
  - 既存のテストを適切なハンドラーテストに分類
  - _要件: 6.4_

- [ ] 7.3 統合テストの更新
  - `test/integration/`のテストファイルのインポートパスを更新
  - 新しい構造での統合テストを確認
  - _要件: 6.4, 6.5_

- [ ] 8. 古いファイルとディレクトリの削除
  - 移動済みの古いファイルとディレクトリを削除する
  - _要件: 6.3_

- [ ] 8.1 古いcommandディレクトリの削除
  - `src/command/`ディレクトリを削除
  - 移動が完了していることを確認
  - _要件: 6.3_

- [ ] 8.2 古いinternalディレクトリの削除
  - `src/internal/`ディレクトリを削除
  - guardsが正しく移動されていることを確認
  - _要件: 6.3_

- [ ] 8.3 古いvalidation.tsファイルの削除
  - `src/utils/validation.ts`を削除
  - 新しい構造に移動済みであることを確認
  - _要件: 6.3_

- [ ] 9. ビルドとテストの検証
  - 新しい構造でビルドとテストが正常に動作することを確認する
  - _要件: 6.3, 6.4, 6.5_

- [ ] 9.1 TypeScriptコンパイルの検証
  - `npm run build`を実行してコンパイルエラーがないことを確認
  - 型チェックが正常に動作することを確認
  - _要件: 6.3_

- [ ] 9.2 テストスイートの実行
  - `bun test`を実行してすべてのテストがパスすることを確認
  - 新しい構造でのテストカバレッジを確認
  - _要件: 6.4, 6.5_

- [ ] 9.3 CLIの動作確認
  - 生成されたCLIが正常に動作することを確認
  - 既存の機能が破損していないことを確認
  - _要件: 6.5_
